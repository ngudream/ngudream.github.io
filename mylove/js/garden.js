function Vector(t,n){this.x=t,this.y=n}function Petal(t,n,o,r,e,i){this.stretchA=t,this.stretchB=n,this.startAngle=o,this.angle=r,this.bloom=i,this.growFactor=e,this.r=1,this.isfinished=!1}function Bloom(t,n,o,r,e){this.p=t,this.r=n,this.c=o,this.pc=r,this.petals=[],this.garden=e,this.init(),this.garden.addBloom(this)}function Garden(t,n){this.blooms=[],this.element=n,this.ctx=t}Vector.prototype={rotate:function(t){var n=this.x,o=this.y;return this.x=Math.cos(t)*n-Math.sin(t)*o,this.y=Math.sin(t)*n+Math.cos(t)*o,this},mult:function(t){return this.x*=t,this.y*=t,this},clone:function(){return new Vector(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},set:function(t,n){return this.x=t,this.y=n,this}},Petal.prototype={draw:function(){var t,n,o,r,e=this.bloom.garden.ctx;t=new Vector(0,this.r).rotate(Garden.degrad(this.startAngle)),n=t.clone().rotate(Garden.degrad(this.angle)),o=t.clone().mult(this.stretchA),r=n.clone().mult(this.stretchB),e.strokeStyle=this.bloom.c,e.beginPath(),e.moveTo(t.x,t.y),e.bezierCurveTo(o.x,o.y,r.x,r.y,n.x,n.y),e.stroke()},render:function(){this.r<=this.bloom.r?(this.r+=this.growFactor,this.draw()):this.isfinished=!0}},Bloom.prototype={draw:function(){var t,n=!0;this.garden.ctx.save(),this.garden.ctx.translate(this.p.x,this.p.y);for(var o=0;o<this.petals.length;o++)t=this.petals[o],t.render(),n*=t.isfinished;this.garden.ctx.restore(),1==n&&this.garden.removeBloom(this)},init:function(){for(var t=360/this.pc,n=Garden.randomInt(0,90),o=0;o<this.pc;o++)this.petals.push(new Petal(Garden.random(Garden.options.petalStretch.min,Garden.options.petalStretch.max),Garden.random(Garden.options.petalStretch.min,Garden.options.petalStretch.max),n+o*t,t,Garden.random(Garden.options.growFactor.min,Garden.options.growFactor.max),this))}},Garden.prototype={render:function(){for(var t=0;t<this.blooms.length;t++)this.blooms[t].draw()},addBloom:function(t){this.blooms.push(t)},removeBloom:function(t){for(var n,o=0;o<this.blooms.length;o++)if(n=this.blooms[o],n===t)return this.blooms.splice(o,1),this},createRandomBloom:function(t,n){this.createBloom(t,n,Garden.randomInt(Garden.options.bloomRadius.min,Garden.options.bloomRadius.max),Garden.randomrgba(Garden.options.color.rmin,Garden.options.color.rmax,Garden.options.color.gmin,Garden.options.color.gmax,Garden.options.color.bmin,Garden.options.color.bmax,Garden.options.color.opacity),Garden.randomInt(Garden.options.petalCount.min,Garden.options.petalCount.max))},createBloom:function(t,n,o,r,e){new Bloom(new Vector(t,n),o,r,e,this)},clear:function(){this.blooms=[],this.ctx.clearRect(0,0,this.element.width,this.element.height)}},Garden.options={petalCount:{min:8,max:15},petalStretch:{min:.1,max:3},growFactor:{min:.1,max:1},bloomRadius:{min:8,max:10},density:10,growSpeed:1e3/60,color:{rmin:128,rmax:255,gmin:0,gmax:128,bmin:0,bmax:128,opacity:.1},tanAngle:60},Garden.random=function(t,n){return Math.random()*(n-t)+t},Garden.randomInt=function(t,n){return Math.floor(Math.random()*(n-t+1))+t},Garden.circle=2*Math.PI,Garden.degrad=function(t){return Garden.circle/360*t},Garden.raddeg=function(t){return t/Garden.circle*360},Garden.rgba=function(t,n,o,r){return"rgba("+t+","+n+","+o+","+r+")"},Garden.randomrgba=function(t,n,o,r,e,i,a){var s=Math.round(Garden.random(t,n)),h=Math.round(Garden.random(o,r)),d=Math.round(Garden.random(e,i)),c=5;return Math.abs(s-h)<=c&&Math.abs(h-d)<=c&&Math.abs(d-s)<=c?Garden.rgba(t,n,o,r,e,i,a):Garden.rgba(s,h,d,a)};